\chapter{Desarrollo}
\label{cap:hardware}

\section{Búsqueda de información}
\label{busqueda_informacion}

Desde la fábrica, no nos facilitan un listado con el hardware instalado en la línea de extrusión, ya que no existe, por tanto, el primer paso es identificar el hardware que disponemos con ayuda de las fotos tomadas:
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.4\textwidth]{images/huesca/IMG_20141216_174810.jpg}
            \caption{Variador Optidrive}
            \label{fig:hardware_variador}
    \end{figure}

    \begin{figure}[H]
            \centering
            \includegraphics[width=0.4\textwidth]{images/huesca/IMG_20141216_174824.jpg}
            \caption{Sensor de diámetro y perifería}
            \label{fig:hardware_diametro}
    \end{figure}

    \begin{figure}[H]
            \centering
            \includegraphics[width=0.4\textwidth]{images/huesca/IMG_20141216_174925.jpg}
            \caption{Perifería distribuida}
            \label{fig:hardware_periferia}
    \end{figure}

    \begin{figure}[H]
            \centering
            \includegraphics[width=0.4\textwidth]{images/huesca/IMG_20141216_175108.jpg}
            \caption{Pantalla HMI}
            \label{fig:hardware_HMI}
    \end{figure}

     \begin{figure}[H]
            \centering
            \includegraphics[width=0.4\textwidth]{images/huesca/IMG_20141216_175204.jpg}
            \caption{Sensores de temperatura}
            \label{fig:hardware_temperatura}
    \end{figure}

Con ayuda de los responsables de la fábrica y buscando los números de serie que aparecen en las fotos anteriores, llegamos a la conclusión de que el hardware que disponemos es el siguiente:

\begin{itemize}
	\item \textbf{Reguladores temperatura Extrusora:} 5x Eroelectronic LFS
	\item \textbf{Regulador temperatura bañera:} 1x OMRON E5CC
	\item \textbf{Bobinadora: IO distribuidas: }
	\begin{itemize}

       \item {SmartStix I/O:} HE559DQM706B y HE559DI710B
       \item{HMI:} HE-XT351C112CF
        \item{Variador (control tractora):} Optidrive rrp2 ODP-24400-SP
        \item{Sensor diámetro:} conectado a módulo Adam 6066
        	\begin{itemize}
        				\item Omron ZX-GIF41 (RS232)
        				\item Omron ZX-GTC41 (Controlador)
                        \item Omron ZX-GT28S41 (sensor)
             \end{itemize}
        \item Relés: OMRON MY2IN
    \end{itemize}
\end{itemize}

Así mismo, disponemos de los datasheet y sabemos qué tipo de comunicación podemos disponer con cada uno, información necesaria para poder establecer la arquitectura del sistema.

\section{Arquitectura planteada}
\label{arquitectura}

Antes de plantear la arquitectura, deberemos establecer el protocolo de comunicaciones y el medio físico por el que irán conectados entre sí. El protocolo establece las reglas necesarias para que dos dispositivos se comuniquen correctamente, haciendo un símil con la realidad, sería el idioma que usan dos personas para hablar. Si dos personas mantienen una conversación en un distinto lenguaje, no se entenderán. Y el medio físico, es cómo se hará la comunicación. Mirando las especificaciones de los componentes llegamos a la siguiente conclusión

\begin{table}[H]

\begin{tabular}{ccc}
\hline
{\bf Dispositivo}     & {\bf Protocolo} & {\bf Medio} \\ \hline
Senores temperatura   & Modbus          & RS485       \\
Pantalla HMI          & Modbus          & RS485       \\
Adam                  & Modbus-TCP      & RS485       \\
Sensor diámetro       & -               & RS232       \\
Variador              & Modbus-TCP      & RS485       \\
Perifería distribuida & CsCAN           & Modbus      \\
Bobinadora            &                 & Cableado    \\ \hline
\end{tabular}
\centering
\caption{Dispositivos disponibles}
\label{tab:dispositivos}
\end{table}

Todos los dispositivos usan protocolos de comunicaciones industriales, como son Modbus y CsCAN. El sensor de diámetro por ejemplo, está conectado a un PC mediante 
RS232, en el que un software almacena en una base de datos SQLITE (ver imagen \ref{fig:hardware_sensor_diametro}) las medidas que se van tomando, por ello, será necesario acceder a esa base de datos.
 	\begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/Parametros_adquisicin.jpg}
            \caption{Programa que almacena las medidas tomadas en el sensor de diámetro}
            \label{fig:hardware_sensor_diametro}
    \end{figure}

La bobinadora, no usa ningún protocolo de comunicaciones, mediante señales de entrada salida, ese va realizando la comunicación.\\

Por tanto, con esta información, podemos establecer la arquitectura del sistema.\\

 	\begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{images/20141229.png}
            \caption{Arquitectura propuesta}
            \label{fig:hardware_arquitectura}
    \end{figure}

Debemos buscar por tanto, un autómata programable industrial (PLC) que cumpla con las siguientes especificaciones:

\begin{table}[H]
\centering
\begin{tabular}{|c|c|c|}
\hline
\textbf{Característica }                              & \textbf{Descripción}            & \textbf{Cantidad} \\ \hline
\multirow{3}{*}{Comunicaciones industriales} & Ethernet               & 1        \\ \cline{2-3} 
                                             & RS485                  & 1        \\ \cline{2-3} 
                                             & RS232                  & 1        \\ \hline
Software                                     & Acceso R/W a tabla SQL &          \\ \hline
Almacenamiento externo                       & USB o SD               & 1        \\ \hline
\multirow{2}{*}{Periferia digital}           & Entrada                & 8        \\ \cline{2-3} 
                                             & Salida                 & 0        \\ \hline
\multirow{2}{*}{Periferia analógica}         & Entrada                & 4        \\ \cline{2-3} 
                                             & Salida                 & 1        \\ \hline
\end{tabular}
\caption{Especificaciones PLC}
\label{tab:espc_plc}
\end{table}

\section{Elección del PLC}
\label{eleccion_PLC}

También se intentará buscar una marca que nos ofrezca las siguientes ventajas, no siendo estas imprescindibles, pero si ayudarán a la hora de elegir un modelo u otro:

\begin{itemize}
		\item{Licencia de desarrollo libre.}
		\item{Modelo básico con el mayor número de especificaciones necesarias.}
		\item{Capacidad de expansión de las características por medio de módulos.}
\end{itemize}

De este modo, conseguiremos reducir el coste total del proyecto. Partiendo de estos requisitos y buscando distintos proveedores por internet, las empresas que mejor se ajustan son:

\begin{itemize}
		\item{\textbf{UNITRONICS:} La compañía ofrece un PLC con pantalla HMI de bajo coste, que es idóneo para pequeños proyectos que no requieran demasiada capacidad. El principal problema es que no dispone de ninguna expansión para almacenar en tarjetas SD, ni se tiene conocimiento de que se pueda conectar a una base de datos MYSQL de forma directa.}
		\item{\textbf{WAGO:} Cumple todos los requisitos que necesitamos, sin embargo, es necesario pagar una licencia para poder usar el software disponible}
		\item{\textbf{ABB:} El PLC de la gama eco trae de serie la mayoría de las cosas que necesitamos, además, si no se superan ciertas limitaciones, no es necesario pagar una licencia para poder usar el software de desarrollo.}
\end{itemize}

Se habla con cada uno de los distribuidores que ofrecen los productos en España, pidiendo un presupuesto con el material necesario para suplir las necesidades del proyecto:

\begin{table}[H]
\centering
\begin{tabular}{cc}
{\bf Distribuidor} & {\bf Precio (\euro{})} \\ \hline
Unitronics         & 390              \\
Wago               & 1374             \\
Abb                & 506              \\ \hline
\end{tabular}
\caption{Presupuestos de los tres distribuidores}
\label{tab:presupuestos}
\end{table}

Debido al alto presupuesto que nos propuso Wago se descartó, ya que en una primera aproximación, se eligió por que ofrecían alternativas baratas a grandes empresas como Siemens y ABB, sin embargo en el caso que nos ocupa y como se puede ver en la tabla \ref{tab:presupuestos} el precio de ABB es muy competitivo. De hecho es la marca que se elije, debido a que el coste con la marca Unitronics no supone un gasto excesivo y la fiabilidad de los autómatas y el software que provee es mejor. Además trae de serie un servidor web con el que podremos hacer una interfaz en la que veremos el estado de la fábrica de forma remota. Por ello, el hardware que se decide adquirir es el siguiente:

\begin{itemize}
	\item{PM564-RP-ETH CPU AC500-eCo,128kB,6DI/6DO-R/2AI/1AO, 24VDC. ETH y WEBSERVER. (Requiere: conectores 9+11 polos)}
	\item{AI562 Módulo S500-eCo, 2AI PT100/1000, Ni100/1000, Resist. 150/300 ( Requiere conector 11 polos)}
	\item{MC502 SD Memory Card 512 MB}
	\item{MC503 Adaptador para tarjeta SD de memoria AC500-eCo.}
\end{itemize}

\section{NO SE COMO LLAMARLOOOO}
\label{}

Una vez realizado el pedido del PLC y disponibles los datasheet de los sensores, desde la fábrica de filamento nos informan que no desean continuar con el proyecto y que no nos facilitarán más información acerca del proceso de fabricación. Por ello, el sentido de este proyecto cambia, ya que no podremos tener acceso a los sensores ni ninguna instrumentación de la fábrica.\\

Desde BQ se tienen planes de investigación en lo referente a los polímeros usados en la impresión 3D para poder mejorar en el producto que ofrecen, y hay intención de adquirir dos extrusoras propias:

\begin{itemize}
		\item{Extrusora industrial.}
		\item{Extrusora de laboratorio.}
\end{itemize}

Con cualquiera de estas dos extrusoras se podría implementar el sistema propuesto para este proyecto, sin embargo el principal problema son los tiempos de adquisición que no se tiene planeado comprarlas hasta el último trimestre de 2015, con lo que el plazo de entrega del presente proyecto se alargaría.\\

Podría realizarse el proyecto sin tener ninguno de los materiales, unicamente con el PLC y simuladores del protocolo MODBUS, pero no sería algo completo. En el departamento de robótica e innovación de BQ se dispone de un KIT DIY de una extrusora de filamento, filastruder.\\

	\begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{images/filaextruder/IMG_20150313_111634.jpg}
            \caption{Maqueta de filastruder montada}
            \label{fig:hardware_filastruder}
    \end{figure}

Filastruder se presenta como proyecto en Noviembre de 2012 \cite{filastruder} y consiguió recaudar $212.278 \$$ en una campaña de kickstarter. Es un extrusor de baja capacidad y de bajo coste, liberado como Open Source. Todo el proceso de construcción del extrusor se documento en el foro y se creó una comunidad de usuarios interesados en los extrusores caseros.\\

Algunas de las características de este extrusor son:

\begin{table}[H]
\centering

\begin{tabular}{lc}
\textbf{Par de detenimiento del motor}            & $12N.m$                           \\
\textbf{Velocidad del motor}                      & $3 rpm$                           \\
\textbf{Tiempo para extruir 1kg}                  & $24H$                             \\
\textbf{Diámetro del husillo}                     & $15.875mm$                        \\
\textbf{Longitud del husillo}					  & $255mm$           				  \\
\textbf{Tolerancia declarada}					  & $\pm 0.05 mm$					  \\	

\end{tabular}
\caption{Características filastruder. Fuente\cite{tfg_diego}}
\label{tab:caract_filas}
\end{table}

La filastruder que disponemos, trae un controlador PID que mediante una resistencia de potencia y un termopar tipo J, consigue regular la temperatura del dado de la extrusora. Así mismo, trae un motor de continua, con una etapa reductora, para poder mover el husillo y hacer avanzar los pellets de PLA por el cañón.\\

La maqueta lleva parada alrededor de un año y no se sabe muy bien si su funcionamiento es el correcto, por ello, se monta con una fuente de alimentación y se comprueba si al menos es capaz de mover el husillo y calentar el cartucho.\\

	\begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{images/filaextruder/IMG_20150225_093400.jpg}
            \caption{Maqueta de filastruder funcionando}
            \label{fig:hardware_filastruder2}
    \end{figure}
    	\begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{images/filaextruder/IMG_20150225_124525.jpg}
            \caption{Maqueta de filastruder funcionando}
            \label{fig:hardware_filastruder3}
    \end{figure}

Después de vaciar y limpiar correctamente el cañón, comprobamos que el funcionamiento del filastruder puede sernos útil para al menos, hacer un proyecto a escala reducida de lo que originariamente se pensó. Por tanto, los objetivos vistos en el capítulo \ref{cap:objetivos}, página \pageref{cap:objetivos},no cambian y decidimos continuar usando el filastruder como herramienta.\\

En este punto, tenemos accesibles los materiales necesarios para la realización del proyecto,  así podremos avanzar en el proyecto sin necesidad de pedir permisos a terceras personas,sin embargo se añaden nuevas tareas al proyecto, como la puesta en marcha de nuestra propia extrusora, lo cual añadirá una dificultad extra.\\

\section{Montaje Filastruder}
\label{sec:filastruder}

El control de temperatura del filastruder se realiza mediante un regulador PID modelo Sestos D1S. Conectándole el termopar tipo J y el cartucho calefactor, es capaz de regular la temperatura que deseemos del dado, el único problema es que no dispone de comunicaciones industriales, y sólo se puede introducir la temperatura deseada mediante el display que incorpora.
   	\begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{images/filaextruder/IMG_20150814_123957.jpg}
            \caption{Controlador PID de temperatura Sestos}
            \label{fig:hardware_sestos}
    \end{figure}

Se decide entonces no usar el PID e integrar el control de temperatura en el PLC ya que, con el hardware que compramos tenemos dos entradas analógicas capaces de leer sensores de temperatura del tipo PT100. De este modo, podremos introducir dos zonas de calentamiento, una en el dado del cañón y otra en la entrada de los pellet para poder tener varios registros de temperaturas como se tenía en la idea principal, que se disponían hasta cinco sensores de temperatura.\\

Se pasa a instalar sobre una plancha de madera la filastruder y todo el cableado futuro que se va a usar a lo largo del proyecto:\\

   	\begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{images/filaextruder/IMG_20150313_114401.jpg}
            \caption{Se ancla la extructura a la base}
            \label{fig:fila_montaje1}
    \end{figure}
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{images/filaextruder/IMG_20150324_175818.jpg}
            \caption{Calefactor en la alimentación y cañon}
            \label{fig:fila_montaje2}
    \end{figure}
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.6\textwidth]{images/filaextruder/IMG_20150325_145634.jpg}
            \caption{Sensor PT100 de temperatura}
            \label{fig:fila_montaje3}
    \end{figure}

Una vez instalados los cartuchos y las sondas de temperatura en la filastruder, se pasa a aislar el cañón para que la disipación de calor al exterior no sea elevada y poder mantener una temperatura constante.\\

    \begin{figure}[H]
            \centering
            \includegraphics[width=0.4\textwidth]{images/filaextruder/IMG_20150814_132929.jpg}
            \caption{Filastruder montado}
            \label{fig:fila_montaje4}
    \end{figure}

El siguiente paso es cablear todas las señales a un armario que instalaremos en la propia maqueta en el espacio reservado para ello, este armario estará conectado al armario del PLC para poder realizar el control de la maqueta:\\

    \begin{itemize}
    	\item Sondas de temperatura.
    	\item Reles para controlar las resistencias de potencia y el motor del husillo.
    \end{itemize}

El circuito eléctrico a cablear está indicado en el Anexo \ref{ane:esquemas_electricos}.\\

    \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/maqueta/IMG_20150324_162200.jpg}
            \caption{Presentación de los componentes en el lugar adecuado.}
            \label{fig:maque_montaje5}
    \end{figure}
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/maqueta/IMG_20150324_162705.jpg}
            \caption{Atornillamos las canaletas y guias a la madera.}
            \label{fig:maque_montaje6}
    \end{figure}
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/maqueta/IMG_20150324_173716.jpg}
            \caption{Cableamos los componentes según los esquemas.}
            \label{fig:maque_montaje7}
    \end{figure}
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/maqueta/IMG_20150331_125243.jpg}
            \caption{Aspecto final cuadro eléctrico maqueta.}
            \label{fig:maque_montaje8}
    \end{figure}
\section{Montaje armario PLC}
A continuación, se va a realizar el montaje del armario eléctrico del PLC, en este armario, irá el siguiente material:

    \begin{itemize}
        \item{Protecciones eléctricas.}
        \item{Fuente de alimentación para conseguir 24V de tensión continua.}
        \item{PLC y tarjeta de expansión}
        \item{Bornas de conexión.}
    \end{itemize}

    \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/cuadro/IMG_20150311_162414.jpg}
            \caption{Lámina, canaleta y guía donde irá el PLC.}
            \label{fig:cuad_montaje1}
    \end{figure}
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/cuadro/IMG_20150311_164348.jpg}
            \caption{Cortamos la guía y canaleta según las necesidades.}
            \label{fig:cuad_montaje2}
    \end{figure}
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/cuadro/IMG_20150313_143943.jpg}
            \caption{Comprobamos que entra dentro del armario.}
            \label{fig:cuad_montaje3}
    \end{figure}
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/cuadro/IMG_20150313_182301.jpg}
            \caption{Cableamos los dispositivos entre sí.}
            \label{fig:cuad_montaje4}
    \end{figure}
       \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/cuadro/IMG_20150331_113600.jpg}
            \caption{Cableamos las entradas-salidas del PLC.}
            \label{fig:cuad_montaje5}
    \end{figure}
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/cuadro/IMG_20150331_113607.jpg}
            \caption{Regletero con acceso a los pines del PLC.}
            \label{fig:cuad_montaje6}
    \end{figure}
    \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/cuadro/IMG_20150331_114950.jpg}
            \caption{Cuadro terminado.}
            \label{fig:cuad_montaje7}
    \end{figure}

Hasta el momento, tenemos todo el hardware del PLC disponible así como la extrusora para poder crear el filamento, nos faltaría por adquirir un sensor de diámetro para poder registrar todas las temperaturas y llegar a uno de los objetivos planteados que es sacar el modelo de la planta.\\

Se buscan modelos industriales de sensores de diámetro como los que se usan en la fábrica de Huesca, sin embargo, su precio se sale del presupuesto establecido para el proyecto. Por ello, debemos buscar una alternativa barata y que sea funcional.\\

Buscando por internet se encuentra un proyecto en la web thingiverse \cite{thing_filamento} de un sensor de diámetro DIY con licencia Creative Commons. En el que se incluye toda la documentación necesaria para realizar un sensor de diámetro analógico el cual es capaz de medir filamentos de hasta 3mm, lo cual entra dentro de nuestro margen de trabajo (filamento de 1.75mm).\\


\section{Sensor de diámetro DIY}
\label{sec:sensor}
El sensor funciona de la siguiente manera. Dispone de un sensor CCD lineal de 1x128 pixels (ver imagen \ref{fig:sens_CCD}), el cual es iluminado de forma constante por un LED de alta luminancia, el filamento, al pasar por encima del sensor, proyecta una sombra sobre él, haciendo que los pixeles tenga distinta luminosidad, de esa manera, un microcontrolador es capaz de calcular el diámetro del elemento que está por encima del sensor, una vez calculado el diámetro, usando un conversor DAC, escribe en una salida analógica un valor de tensión  (comprendido entre 0-3v), teniendo ua relación directa mm-V, es decir, para un diámetro de $1.75 mm$, obtendremos a la salida $1.75 V$\\
   \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/sensor/IMG_20150414_135533_.jpg}
            \caption{Sensor CCD lineal.}
            \label{fig:sens_CCD}
    \end{figure}

El usuario, vende los sensores a través de internet ya montados, programados y calibrados, lo cual nos interesa ya que nos ahorraría tiempo en la integración con el proyecto, sin embargo, al ir a hacer el pedido, no hay stock y el usuario no tiene planes de vender más. Pero como dijimos anteriormente, está toda la información accesible en internet para poder realizar por nosotros mismos uno, esta es una de las ventajas del Open Source, así pues, pusimos en marcha los pedidos con el material correspondiente. De esta manera también ahorraríamos dinero, ya que el precio de venta es de 60\euro{} frente a lo 14\euro{} si el montaje lo realizamos nosotros.\\

El trabajo necesario para poner en marcha el sensor es el siguiente:

\begin{itemize}
\item{Realizar el pedido en una tienda de electrónica.}
\item{Realizar placa de circuito impreso (PCB) del sensor.}
\item{Soldar componentes a la PCB.}
\item{Programar microcontroaldor.}
\item{Comprobar correcto funcionamiento.}
\end{itemize}


Se realiza el pedido a la empresa Mouser, que es un distribuidor de componentes electrónicos, con el siguiente material.

\begin{table}[H]
\centering
\begin{tabular}{cc}
{\bf Descripción}                 & {\bf Cantidad} \\ \hline
Condensador cerámico SMD $0.1 \mu F$ & 2              \\
Condensador cerámico SMD $1 \mu F$   & 2              \\
Condensador cerámico SMD $10 \mu F$  & 1              \\
LED Trough hole Rojo             & 1              \\
LED SMD Rojo                     & 1              \\
Resistencia SMD 1/8 WAT 150ohms  & 1              \\
Resistencia SMD 1/8 WAT 300ohms  & 1              \\
Resistencia SMD 1/8 WAT 1Kohms   & 1              \\
Pulsadores SMD                   & 1              \\
8bit Microcontrolador Freescale  & 1              \\
Sensor CCD 1x128 pixeles         & 1             
\end{tabular}
\caption{BOM sensor de diámetro}
\label{tab:BOM}
\end{table}

Para conseguir la PCB se usan los ficheros gerber disponibles en la web del proyecto \cite{thing_filamento}. Los ficheros gerber, contienen la información necesaria para la fabricación de la placa de circuito impreso.

   \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/sensor/gerber.png}
            \caption{Fichero gerber de la pcb.}
            \label{fig:sens_gerber}
    \end{figure}

La única manera de realizar las PCB que disponemos es encargándola por internet \footnote{http://www.seeedstudio.com/depot/}. Enviamos los gerber y tras establecer las especificaciones de la PCB en unos días recibimos el pedido.\\
   \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/sensor/IMG_20150414_105219_.jpg}
            \caption{PCB ya fabricada.}
            \label{fig:sens_pcb}
    \end{figure}

El siguiente paso será soldar todos los componentes. En este caso, la mayoría de los componentes son de montaje superficial (SMD) por ello necesitaremos el siguiente material, para que la soldadura sea más fácil.

	\begin{itemize}
		\item{Soldador.}
		\item{Estaño fino.}
		\item{Flux.}
		\item{Pinzas de punta fina.}
	\end{itemize}
   \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/sensor/IMG_20150417_160216.jpg}
            \caption{Materiales necesarios para soldar}
            \label{fig:sens_materiales}
    \end{figure}

El componente más complicado de soldar es el microcontrolador ya que tiene sus pines muy cercanos entre sí. Para evitar que el estaño cortocircuite dos pines, se esparcirá Flux que es un líquido que ayuda a la hora de soldar, limpiando la superficie y haciendo que sea más fácil de fundir el estaño.\\
   \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/sensor/IMG_20150414_111135.jpg}
            \caption{Soldando el microcontrolador.}
            \label{fig:sens_micro}
    \end{figure}

El resto de componentes SMD son fáciles de soldar y con ayuda de la pinza se irán soldando en orden.
   \begin{figure}[H]
            \centering
            \includegraphics[width=0.4\textwidth]{images/sensor/IMG_20150414_135533.jpg}
            \caption{Soldando componentes SMD.}
            \label{fig:sens_SMD}
    \end{figure}
Los últimos componentes a soldar serán los que atraviesen la placa de circuito impreso con sus pines (Trough hole) terminando así de soldar todos los componentes:\\
   \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/sensor/IMG_20150417_121941.jpg}
            \caption{Placa con los componentes soldados.}
            \label{fig:sens_SMD2}
    \end{figure}

Por último, programaremos el microcontrolador con el firmware que nos bajamos e introduciremos la PCB ya soldada, en una carcasa de plástico que imprimimos con ayuda de una impresora 3D.
   \begin{figure}[H]
            \centering
            \includegraphics[width=0.5\textwidth]{images/sensor/IMG_20150417_134451.jpg}
            \caption{Sensor midiendo un filamento de 1.75mm.}
            \label{fig:sens_midiendo}
    \end{figure}

Al realizar varias medidas, se comprueba que se comete un ligero error en la medida, y eso es debido a que a la hora de calibrar no disponemos de un varilla con la misma medida con la que el usuario realizó la programación. Después de realizar unas mediciones con el sensor de unas dimensiones conocidas, estos son los valores obtenidos.\\

\begin{table}[H]
\centering

\begin{tabular}{cc}
{\bf Voltaje (V)} & {\bf Diametro real(mm)} \\ \hline
0                 & 0                       \\
1,13              & 1,14                    \\
1,56              & 1,57                    \\
1,82              & 1,82                    \\
1,93              & 1,94                    \\
2,37              & 2,36                    \\
2,77              & 2,74                   
\end{tabular}
\caption{Mediciones con el sensor }
\label{tab:medici_senso}
\end{table}

Como comprobamos en la tabla \ref{tab:medici_senso} se comete un error en cada medida, por ello, se realiza una regresión lineal para intentar minimizar el error cometido.

   \begin{figure}[H]
            \centering
            \includegraphics[width=0.9\textwidth]{images/sensor/linealidad_sensor.png}
            \caption{Gráfica con regresión lineal.}
            \label{fig:sens_regre}
    \end{figure}

La ecuación de la recta que minimiza el error en la medición es:
$$y= 0.991*x +0.015$$

Hasta el momento, hemos conseguido los siguientes objetivos que definimos en el capítulo \ref{cap:objetivos}. Ver página \pageref{Listado_objetivos}.

\begin{itemize}
	\item Documentación de la instrumentación de la planta.
	\item Definir la arquitectura para la comunicación del PLC y la instrumentación
	\item Definir requisitos del PLC a adquirir.
	\item Realización del armario eléctrico para montar en la fábrica.
\end{itemize}

Y nos quedaría por completar:

\begin{itemize}
	\item Programación del PLC.
	\item Estudio de los datos adquiridos y desarrollo del modelo teórico de la planta.
	\item Comprobar qué regulador se amolda a nuestras necesidades.
	\item Puesta en marcha del regulador en planta y comprobar resultados.
\end{itemize}